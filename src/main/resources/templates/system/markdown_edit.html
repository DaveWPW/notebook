<div id="layout">
    <form action="markdown/doAddMarkdown" method="post">
        <div style="display: none; margin:0px 5px 5px 0px;" id="markdownName">
            <input type="text" name="markdownName" class="markdown-name">.md
        </div>
        <div id="test-editormd">
            <textarea style="display:none;" id="markdownContent" name="markdownContent"></textarea>
        </div>
        <button type="submit" class="btn btn-info col-md-offset-3 col-md-6">保存
        </button>
    </form>
</div>
<script type="text/javascript">
    var testEditor;
    $(function () {
        testEditor = editormd("test-editormd", {
            width: "100%",
            height: 500,
            syncScrolling: "single",
            path: "bower_components/editormd/lib/",
            imageUpload: true,
            imageFormats: ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
            imageUploadURL: "markdown/doImageUpload",
        });
        $("#test-editormd").on("click", ".editormd-preview-close-btn", doCancel);
        var fileName = $("#mainContentId").data("fileName");
        if (fileName != "README") {
            $("#markdownName").show();
            $(".markdown-name").val(fileName);
        }
        var url = "markdown/doGetMarkdownData";
        var params = {"fileName": fileName}
        $.post(url, params, function (result) {
            if (result.state == 1) {
                $("#markdownContent").val(result.data);
                $("#markdownName").find("input").val(fileName);
                $("#mainContentId").removeData("fileName");
            } else {
                alert("获取" + fileName + ".md内容失败！！");
            }
        });
    });
    function doCancel() {
        var fileName = $(".markdown-name").val();
        console.log(fileName);
        if(fileName != "README"){
            $("#mainContentId").load("md_menu/doMdMenuEditUI");
        }else{
            window.location.href = "doIndexUI";
        }
    }
    //console.log();
    //alert();
    //debugger;
</script>